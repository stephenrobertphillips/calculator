<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Voltage Drop & Fuse Calculator</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    input, select, button { margin: 10px 0; padding: 5px; }
    .result span { font-weight: bold; }
    .voltage-drop { color: black; }
    .voltage-drop.orange { color: orange; }
    .voltage-drop.red { color: red; }
  </style>
</head>
<body>
  <h1>Voltage Drop & Fuse Calculator</h1>

  <label>System Voltage:
    <select id="voltage" onchange="toggleCustomVoltage()">
      <option value="12">12V</option>
      <option value="24">24V</option>
      <option value="48">48V</option>
      <option value="custom">Custom</option>
    </select>
  </label><br>
  <input type="number" id="customVoltage" placeholder="Enter custom voltage" style="display:none"><br>

  <label>Inverter or Load Wattage:
    <input type="number" id="wattage" placeholder="e.g. 2000">
  </label><br>

  <label>Cable Length in Metres (both ways):
    <input type="number" id="length" placeholder="e.g. 5">
  </label><br>

  <button onclick="calculate()">Calculate</button>

  <div class="result" id="result"></div>

  <script>
    function toggleCustomVoltage() {
      const voltageSelect = document.getElementById('voltage');
      const customVoltageInput = document.getElementById('customVoltage');
      customVoltageInput.style.display = voltageSelect.value === 'custom' ? 'block' : 'none';
    }

    function calculate() {
      const voltageSelect = document.getElementById('voltage');
      const customVoltageInput = document.getElementById('customVoltage');
      const wattage = parseFloat(document.getElementById('wattage').value);
      const length = parseFloat(document.getElementById('length').value);

      let voltage;
      if (voltageSelect.value === 'custom') {
        voltage = parseFloat(customVoltageInput.value);
        if (isNaN(voltage)) {
          alert('Please enter a valid custom voltage.');
          return;
        }
      } else {
        voltage = parseFloat(voltageSelect.value);
      }

      if (isNaN(wattage) || isNaN(length)) {
        alert('Please enter valid numbers for wattage and cable length.');
        return;
      }

      const current = wattage / voltage;
      const fuseCurrent = Math.ceil(current * 1.25);

      // Recommend fuse type
      let fuseType = '';
      if (fuseCurrent <= 25) {
        fuseType = 'Blade Fuse';
      } else if (fuseCurrent <= 180) {
        fuseType = 'Midi Fuse';
      } else {
        fuseType = 'Mega Fuse';
      }

      // Standard fuse options list (rounded preferred to nearest 5A)
      const standardFuses = [5, 7.5, 10, 15, 20, 25, 30, 40, 50, 60, 70, 80, 100, 125, 150, 175, 200, 250, 300, 400, 500];
      const fuseOptions = standardFuses.filter(f => f >= fuseCurrent && f <= current * 1.5);

      // Cable sizing estimate (simplified reference table in mm²)
      const cableSizes = [1.5, 2.5, 4, 6, 10, 16, 25, 35, 50, 70, 90];
      const maxCurrentCapacity = [18, 24, 36, 45, 65, 90, 120, 140, 170, 200, 240];
      let recommendedSize = 'Unknown';
      for (let i = 0; i < cableSizes.length; i++) {
        if (current <= maxCurrentCapacity[i]) {
          recommendedSize = `${cableSizes[i]} mm²`;
          break;
        }
      }

      // Voltage drop estimate (simplified, copper, mV/A/m)
      const resistanceTable = {
        1.5: 12, 2.5: 7.4, 4: 4.6, 6: 3.1, 10: 1.8, 16: 1.2,
        25: 0.7, 35: 0.5, 50: 0.36, 70: 0.25, 90: 0.195
      };
      const resistance = resistanceTable[parseFloat(recommendedSize)] || 1.5;
      const voltDrop = (current * length * resistance) / 1000;
      const voltDropPercent = (voltDrop / voltage) * 100;

      const dropClass = voltDropPercent > 10 ? 'red' : voltDropPercent > 3 ? 'orange' : 'black';

      document.getElementById('result').innerHTML = `
        <p>Current: <span>${current.toFixed(1)} A</span></p>
        <p>Recommended Fuse Size: <span>${fuseOptions[0] || fuseCurrent} A</span></p>
        <p>Recommended Fuse Type: <span>${fuseType}</span></p>
        <p>Recommended Cable Size: <span>${recommendedSize}</span></p>
        <p class="voltage-drop ${dropClass}">Voltage Drop: <span>${voltDrop.toFixed(2)} V (${voltDropPercent.toFixed(1)}%)</span>
        ${voltDropPercent > 10 ? ' - <strong>Non-compliant to AS3001.2</strong>' : ''}</p>
      `;
    }
  </script>
</body>
</html>
